# 6DoF 시뮬레이션 수정 사항 분석 보고서

## 📊 현재 문제점 진단

### 1. 궤적 스케일 문제
**현상:**
- 최대 고도: ~8km (너무 낮음)
- 사거리: ~1km (너무 짧음)
- 비행 시간: ~115초

**교수님 자료 (3DoF) 기준:**
- 최대 고도: ~7km
- 사거리: ~100km
- 비행 시간: ~300초

**원인:** 추력 계산 오류로 미사일이 제대로 가속되지 않음

---

### 2. 추력 계산 오류 (핵심 문제)

#### ❌ 수정 전 (잘못된 코드)
```python
# config.py에서 thrust_profile 정의
"thrust_profile": lambda t: 5860 * 9.81 * 230 / 65 if t < 65 else 0

# main_6dof.py에서 사용
Thrust_b = np.array([self.missile_info["thrust_profile"](t), 0, 0])

# 계산 결과: 5860 * 9.81 * 230 / 65 = 203,000 N (너무 큼!)
```

**문제점:**
- 추력 공식이 물리적으로 잘못됨
- 단위가 맞지 않음 (kg * m/s² * s / s = kg*m/s² = N이지만 계산 로직 오류)
- 고도에 따른 비추력 변화 미반영

#### ✅ 수정 후 (올바른 코드)
```python
# 올바른 추력 공식: T = ISP * 연료소모율 * g
if t < self.burn_time:
    # 고도에 따른 비추력 보간 (해수면 → 진공)
    isp_sea = self.missile_info["isp_sea"]  # 230 s
    isp_vac = self.missile_info["isp_vac"]  # 258 s
    
    if altitude >= 100000:
        isp_current = isp_vac
    else:
        # 선형 보간
        isp_current = isp_sea + (isp_vac - isp_sea) * (altitude / 100000)
    
    # 추력 = ISP * 연료소모율 * g
    mass_flow_rate = self.propellant_mass / self.burn_time  # 4875 / 65 = 75 kg/s
    thrust_magnitude = isp_current * mass_flow_rate * g
    # = 230 * 75 * 9.81 = 169,207 N (해수면)
    # = 258 * 75 * 9.81 = 189,652 N (진공)
    Thrust_b = np.array([thrust_magnitude, 0, 0])
```

**개선 사항:**
- 물리적으로 올바른 추력 공식 적용
- 고도에 따른 비추력 보간 (해수면 230s → 진공 258s)
- 교수님 자료의 3DoF 모델과 동일한 추력 계산 방식

---

### 3. 피치각 진동 문제

#### ❌ 수정 전
```python
Kp = 1000  # 비례 게인 (너무 높음)
Kd = 500   # 미분 게인 (너무 높음)
max_control_moment = 50000  # N·m (너무 큼)
```

**문제점:**
- 제어 게인이 너무 높아 오버슈트 발생
- 피치각이 초기에 크게 진동
- 최종적으로 45도로 수렴하지만 불안정

#### ✅ 수정 후
```python
Kp = 500   # 비례 게인 (50% 감소)
Kd = 300   # 미분 게인 (40% 감소)
max_control_moment = 30000  # N·m (40% 감소)
```

**개선 사항:**
- 제어 게인 감소로 안정성 향상
- 부드러운 피치 기동
- 댐핑 효과와 조합하여 진동 억제

---

### 4. 속도 프로파일 개선

**수정 전:**
- 최대 속도: ~2000 m/s (비정상적으로 높음)
- 속도 증가가 너무 급격함

**수정 후 (예상):**
- 최대 속도: ~1500 m/s (SCUD-B 기준)
- 부드러운 가속 프로파일
- 연소 종료 후 점진적 감속

---

## 🔧 수정된 코드 요약

### 1. 추력 계산 (`main_6dof.py` 136-152행)
```python
# ========== ✅ 추력 계산 수정 (교수님 자료 기반) ========== #
if t < self.burn_time:
    # 고도에 따른 비추력 보간 (해수면 -> 진공)
    isp_sea = self.missile_info["isp_sea"]
    isp_vac = self.missile_info["isp_vac"]
    # 100km 이상에서 진공 비추력 사용
    if altitude >= 100000:
        isp_current = isp_vac
    else:
        # 선형 보간
        isp_current = isp_sea + (isp_vac - isp_sea) * (altitude / 100000)
    
    # 추력 = ISP * 연료소모율 * g (올바른 공식)
    thrust_magnitude = isp_current * mass_flow_rate * g
    Thrust_b = np.array([thrust_magnitude, 0, 0])
else:
    Thrust_b = np.array([0, 0, 0])
```

### 2. PD 제어기 게인 조정 (`main_6dof.py` 243-267행)
```python
# ✅ PD 제어기 (비례-미분 제어) - 게인 조정
# P 게인: 낮춰서 안정성 향상
Kp = 500  # 1000 → 500으로 낮춤

# D 게인: 오버슈트 방지
Kd = 300  # 500 → 300으로 낮춤

# 제어 모멘트 제한 (포화 방지)
max_control_moment = 30000  # N·m (50000 → 30000으로 낮춤)
Mc_b[1] = np.clip(Mc_b[1], -max_control_moment, max_control_moment)
```

### 3. 초기 속도 설정 (`main_6dof.py` 71행)
```python
# 초기 속도를 1.0 m/s로 설정 (수치 안정성)
vel_b = np.array([1.0, 0.0, 0.0])  # 초기 속도 (동체좌표계)
```

---

## 📈 예상 개선 효과

### 1. 궤적 스케일
- **사거리**: 1km → ~100km (100배 증가)
- **최대 고도**: 8km → ~25-30km (3-4배 증가)
- **비행 시간**: 115초 → ~300초 (2.6배 증가)

### 2. 속도 프로파일
- **최대 속도**: 2000 m/s → ~1500 m/s (정상 범위)
- **가속도**: 부드러운 증가 곡선
- **최종 속도**: ~300 m/s (탄도 비행 후 감속)

### 3. 피치각 안정성
- **초기 진동**: 크게 감소
- **목표 피치각 도달**: 부드러운 전환
- **탄도 비행**: 안정적인 자세 유지

### 4. 물리 피델리티
- **추력**: 물리적으로 올바른 계산
- **비추력**: 고도에 따른 변화 반영
- **공력**: 댐핑 효과 포함

---

## 🎯 교수님 자료와의 비교

### 공통점 (3DoF vs 6DoF)
1. **추력 계산**: 동일한 공식 사용 (T = ISP × ṁ × g)
2. **비추력 보간**: 고도에 따른 해수면 → 진공 보간
3. **대기 모델**: 표준 대기 모델 사용
4. **비행 단계**: 수직상승 → 피치 기동 → 탄도 비행

### 차이점
1. **자유도**: 3DoF (점 질량) vs 6DoF (강체 동역학)
2. **자세 표현**: 오일러각 vs 쿼터니언
3. **제어**: 프로그램된 피치각 vs PD 제어기
4. **공력 모멘트**: 없음 vs 피치/요 모멘트 + 댐핑

---

## ✅ 검증 방법

### 1. 정량적 검증
- [ ] 사거리: 45도 발사각에서 ~100km 달성
- [ ] 최대 고도: ~25-30km
- [ ] 최대 속도: ~1500 m/s
- [ ] 비행 시간: ~300초

### 2. 정성적 검증
- [ ] 부드러운 속도 증가 곡선
- [ ] 안정적인 피치 기동
- [ ] 탄도 비행 중 자세 안정성
- [ ] 재진입 시 속도 감소

### 3. 교수님 자료와 비교
- [ ] 3D 궤적 형태 유사성
- [ ] 속도 프로파일 유사성
- [ ] 고도 프로파일 유사성
- [ ] 피치각 변화 유사성

---

## 🚀 추가 개선 가능 사항

### 1. 공력 모델 정밀화
```python
# 마하수에 따른 항력계수 테이블 개선
# 받음각에 따른 양력계수 비선형 모델
# 천음속 영역 (M=0.8-1.2) 정밀 모델링
```

### 2. 제어 알고리즘 고도화
```python
# PID 제어기 (적분항 추가)
# 적응형 게인 스케줄링
# 최적 제어 (LQR, MPC)
```

### 3. 환경 모델 개선
```python
# 바람 모델 추가
# 지구 자전 효과 (코리올리)
# 중력 변화 (위도/경도 의존)
```

### 4. 시각화 개선
```python
# 실시간 3D 애니메이션
# 공력 벡터 표시
# 제어 입력 시각화
```

---

## 📝 결론

**핵심 문제:** 추력 계산 공식이 잘못되어 미사일이 제대로 가속되지 않았음

**해결 방법:**
1. 올바른 추력 공식 적용 (T = ISP × ṁ × g)
2. 고도에 따른 비추력 보간
3. PD 제어기 게인 조정
4. 초기 조건 개선

**예상 결과:**
- 사거리 100배 증가 (1km → 100km)
- 물리적으로 타당한 궤적
- 교수님 자료(3DoF)와 유사한 성능

**다음 단계:**
1. 수정된 코드 실행 및 결과 확인
2. 교수님 자료와 정량적 비교
3. 추가 미세 조정 (필요 시)
